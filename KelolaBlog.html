<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>NutraBox</title>
  <link rel="shortcut icon" type="image/png" href="./assets/images/logos/favicon.png" />
  <link rel="stylesheet" href="./assets/css/styles.min.css" />
  <!-- Bootstrap CSS -->


<!-- Bootstrap JS Bundle (includes Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


  
</head>

<body>
  <!--  Body Wrapper -->
  <div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
    data-sidebar-position="fixed" data-header-position="fixed">

    <!--  App Topstrip -->
    <div class="app-topstrip bg-dark py-6 px-3 w-100 d-lg-flex align-items-center justify-content-between">
      <div class="d-flex align-items-center justify-content-center gap-5 mb-2 mb-lg-0">
      </div>
      <div class="d-lg-flex align-items-center gap-2">
        <h3 class="text-white mb-2 mb-lg-0 fs-5 text-center">Check Flexy Premium Version</h3>
        <div class="d-flex align-items-center justify-content-center gap-2">
          
          <div class="dropdown d-flex">
            <a class="btn btn-primary d-flex align-items-center gap-1 " href="javascript:void(0)" id="drop4"
              data-bs-toggle="dropdown" aria-expanded="false">
              <i class="ti ti-shopping-cart fs-5"></i>
              Buy Now
              <i class="ti ti-chevron-down fs-5"></i>
            </a>
          </div>
        </div>
      </div>

    </div>
    <!-- Sidebar Start -->
    <aside class="left-sidebar">
      <!-- Sidebar scroll-->
      <div>
        <div class="brand-logo d-flex align-items-center justify-content-between">
         <a href="./index.html" class="text-nowrap logo-img">
          <img src="img/logo.png" alt="" style="max-height: 50px; width: auto;" />
        </a>

          <div class="close-btn d-xl-none d-block sidebartoggler cursor-pointer" id="sidebarCollapse">
            <i class="ti ti-x fs-6"></i>
          </div>
        </div>
        <!-- Sidebar navigation-->
        <nav class="sidebar-nav scroll-sidebar" data-simplebar="">
          <ul id="sidebarnav">
            <li class="nav-small-cap">
              <iconify-icon icon="solar:menu-dots-linear" class="nav-small-cap-icon fs-4"></iconify-icon>
              <span class="hide-menu">Home</span>
            </li>
            <li class="sidebar-item">
              <a class="sidebar-link" href="dashboard.html" aria-expanded="false">
                <i class="ti ti-atom"></i>
                <span class="hide-menu">Dashboard</span>
              </a>
            </li>
            <!-- ---------------------------------- -->
            <!-- Dashboard -->
            <!-- ---------------------------------- -->
            <li class="sidebar-item">
              <a class="sidebar-link justify-content-between"  
                href="KelolaUser.html" aria-expanded="false">
                <div class="d-flex align-items-center gap-3">
                  <span class="d-flex">
                    <i class="ti ti-aperture"></i>
                  </span>
                  <span class="hide-menu">User</span>
                </div>
                
              </a>
            </li>
            <li>
              <span class="sidebar-divider lg"></span>
            </li>
            <li class="sidebar-item">
            <a class="sidebar-link justify-content-between active" href="KelolaBlog.html" aria-expanded="false">
                <div class="d-flex align-items-center gap-3">
                <span class="d-flex">
                    <i class="ti ti-notes"></i>
                </span>
                <span class="hide-menu">Blog</span>
                </div>
            </a>
            </li>
            <li class="sidebar-item">
              <a class="sidebar-link justify-content-between"  
                href="KelolaProduk.html" aria-expanded="false">
                <div class="d-flex align-items-center gap-3">
                  <span class="d-flex">
                    <i class="ti ti-files"></i>
                  </span>
                  <span class="hide-menu">Produk</span>
                </div>
              </a>
            </li>
            <li class="sidebar-item">
              <a class="sidebar-link justify-content-between"  
                href="kelola_transaksi.html" aria-expanded="false">
                <div class="d-flex align-items-center gap-3">
                  <span class="d-flex">
                    <i class="ti ti-topology-star-3"></i>
                  </span>
                  <span class="hide-menu">Transaksi</span>
                </div>
              </a>
            </li>
            <li class="sidebar-item">
              <a class="sidebar-link justify-content-between"  
                href="index.html" aria-expanded="false">
                <div class="d-flex align-items-center gap-3">
                  <span class="d-flex">
                    <i class="ti ti-shopping-cart"></i>
                  </span>
                  <span class="hide-menu">eCommerce</span>
                </div>
              </a>
            </li>
          </ul>
        </nav>
        <!-- End Sidebar navigation -->
      </div>
      <!-- End Sidebar scroll-->
    </aside>
    <!--  Sidebar End -->
    <!-- Main Content Start -->
    <div class="body-wrapper">
    <div class="container-fluid ">
        <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Kelola Blog</h2>
        <button class="btn btn-primary" id="btnAddBlog">Tambah Blog Baru</button>
        </div>

        <!-- Blog List Table -->
        <div class="table-responsive">
        <table class="table table-bordered table-striped align-middle">
            <thead class="table-dark">
            <tr>
                <th>Judul</th>
                <th>Author</th>
                <th>Tanggal</th>
                <th>Isi Artikel</th>
                <th>Image</th>
                <th>Aksi</th>
            </tr>
            </thead>
            <tbody id="blogTableBody">
            <!-- Konten di-generate oleh JS -->
            </tbody>
        </table>
        </div>
    </div>
    </div>

<!-- Modal Form for Add/Edit Blog -->
<div class="modal fade" id="blogModal" tabindex="-1" aria-labelledby="blogModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <form id="blogForm" enctype="multipart/form-data" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="blogModalLabel">Tambah Blog Baru</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="blogId" name="blogId" />
        <div class="mb-3">
          <label for="judul" class="form-label">Judul</label>
          <input type="text" class="form-control" id="judul" name="judul" required />
        </div>
        <div class="mb-3">
          <label for="author" class="form-label">Author</label>
          <input type="text" class="form-control" id="author" name="author" required />
        </div>
        <div class="mb-3">
          <label for="tanggal" class="form-label">Tanggal</label>
          <input type="date" class="form-control" id="tanggal" name="tanggal" required />
        </div>
        <div class="mb-3">
          <label for="isiArtikel" class="form-label">Isi Artikel</label>
          <textarea class="form-control" id="isiArtikel" name="isiArtikel" rows="5" required></textarea>
        </div>
        <div class="mb-3">
          <label for="image" class="form-label">Gambar</label>
          <input class="form-control" type="file" id="image" name="image" accept="image/*" />
          <img id="previewImage" src="#" alt="Preview" style="max-width: 200px; margin-top: 10px; display:none;" />
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
        <button type="submit" class="btn btn-primary">Simpan</button>
      </div>
    </form>
  </div>
</div>

<script>
  const blogModal = new bootstrap.Modal(document.getElementById('blogModal'));
  const btnAddBlog = document.getElementById('btnAddBlog');
  const blogForm = document.getElementById('blogForm');
  const previewImage = document.getElementById('previewImage');
  const imageInput = document.getElementById('image');
  const blogTableBody = document.getElementById('blogTableBody');

  let blogs = [];

  // Load data dari localStorage saat halaman dibuka
  function loadBlogs() {
    const data = localStorage.getItem('blogs');
    blogs = data ? JSON.parse(data) : [];
  }

  // Simpan data ke localStorage
  function saveBlogs() {
    localStorage.setItem('blogs', JSON.stringify(blogs));
  }

  // Render tabel blog
  function renderBlogs() {
    blogTableBody.innerHTML = '';
    if (blogs.length === 0) {
      blogTableBody.innerHTML = '<tr><td colspan="6" class="text-center">Belum ada data blog.</td></tr>';
      return;
    }
    blogs.forEach((blog, index) => {
      blogTableBody.innerHTML += `
        <tr>
          <td>${blog.judul}</td>
          <td>${blog.author}</td>
          <td>${blog.tanggal}</td>
          <td>${blog.isiArtikel.length > 50 ? blog.isiArtikel.substring(0, 50) + '...' : blog.isiArtikel}</td>
          <td>
            ${blog.image ? `<img src="${blog.image}" alt="Gambar Blog" style="width:80px; height:auto;">` : 'No Image'}
          </td>
          <td>
            <button class="btn btn-sm btn-warning btnEdit" data-index="${index}">Edit</button>
            <button class="btn btn-sm btn-danger btnDelete" data-index="${index}">Delete</button>
          </td>
        </tr>
      `;
    });

    // Pasang event listener untuk tombol Edit dan Delete
    document.querySelectorAll('.btnEdit').forEach(btn => {
      btn.addEventListener('click', e => {
        const idx = e.target.getAttribute('data-index');
        openEditModal(idx);
      });
    });
    document.querySelectorAll('.btnDelete').forEach(btn => {
      btn.addEventListener('click', e => {
        const idx = e.target.getAttribute('data-index');
        deleteBlog(idx);
      });
    });
  }

  // Buka modal untuk tambah blog baru
  btnAddBlog.addEventListener('click', () => {
    blogForm.reset();
    previewImage.style.display = 'none';
    document.getElementById('blogModalLabel').textContent = 'Tambah Blog Baru';
    document.getElementById('blogId').value = '';
    blogModal.show();
  });

  // Preview gambar saat pilih file
  imageInput.addEventListener('change', function() {
    const file = this.files[0];
    if(file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        previewImage.setAttribute('src', e.target.result);
        previewImage.style.display = 'block';
      }
      reader.readAsDataURL(file);
    } else {
      previewImage.style.display = 'none';
    }
  });

  // Simpan data blog dari form
  blogForm.addEventListener('submit', (e) => {
    e.preventDefault();

    const id = document.getElementById('blogId').value;
    const judul = document.getElementById('judul').value.trim();
    const author = document.getElementById('author').value.trim();
    const tanggal = document.getElementById('tanggal').value;
    const isiArtikel = document.getElementById('isiArtikel').value.trim();

    // Tangkap gambar jika ada, convert ke base64 (async)
    const file = imageInput.files[0];

    if (file) {
      const reader = new FileReader();
      reader.onload = function(event) {
        const base64Image = event.target.result;
        saveBlogData(id, judul, author, tanggal, isiArtikel, base64Image);
      };
      reader.readAsDataURL(file);
    } else {
      // Kalau edit dan gambar tidak diganti, pakai gambar lama (kalau ada)
      let base64Image = '';
      if(id) {
        const existingBlog = blogs.find(b => b.id === id);
        base64Image = existingBlog ? existingBlog.image : '';
      }
      saveBlogData(id, judul, author, tanggal, isiArtikel, base64Image);
    }
  });

  // Fungsi simpan/update blog ke array dan localStorage
  function saveBlogData(id, judul, author, tanggal, isiArtikel, image) {
    if(id) {
      // Edit blog
      const idx = blogs.findIndex(b => b.id === id);
      if(idx !== -1) {
        blogs[idx] = { id, judul, author, tanggal, isiArtikel, image };
      }
    } else {
      // Tambah blog baru, buat ID unik
      const newId = 'blog-' + Date.now();
      blogs.push({ id: newId, judul, author, tanggal, isiArtikel, image });
    }
    saveBlogs();
    renderBlogs();
    blogModal.hide();
  }

  // Buka modal edit dengan isi data blog yang dipilih
  function openEditModal(index) {
    const blog = blogs[index];
    if(!blog) return;

    document.getElementById('blogModalLabel').textContent = 'Edit Blog';
    document.getElementById('blogId').value = blog.id;
    document.getElementById('judul').value = blog.judul;
    document.getElementById('author').value = blog.author;
    document.getElementById('tanggal').value = blog.tanggal;
    document.getElementById('isiArtikel').value = blog.isiArtikel;

    if(blog.image) {
      previewImage.src = blog.image;
      previewImage.style.display = 'block';
    } else {
      previewImage.style.display = 'none';
    }

    imageInput.value = ''; // reset input file agar bisa upload baru
    blogModal.show();
  }

  // Hapus blog berdasarkan index
 function deleteBlog(index) {
  Swal.fire({
    title: 'Apakah kamu yakin?',
    text: "Data blog akan dihapus secara permanen!",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#d33',
    cancelButtonColor: '#3085d6',
    confirmButtonText: 'Ya, hapus!',
    cancelButtonText: 'Batal'
  }).then((result) => {
    if (result.isConfirmed) {
      blogs.splice(index, 1);
      saveBlogs();
      renderBlogs();
      Swal.fire(
        'Terhapus!',
        'Data blog berhasil dihapus.',
        'success'
      )
    }
  })
}


  // Inisialisasi
  loadBlogs();
  renderBlogs();
</script>
</body>
</html>